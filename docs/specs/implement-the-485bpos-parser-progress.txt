Feature: implement-the-485bpos-parser
Spec: docs/specs/implement-the-485bpos-parser.md
Created: 2026-02-13

Phase 1: Data Model Updates [COMPLETE]
- ETF.objective_text column already exists
- FeeExpense.acquired_fund_fees column already exists
- ShareholderFee model already exists with all 5 fee columns and unique constraint
- ExpenseExample model already exists with 4 year columns and unique constraint
- ETF relationships already exist for shareholder_fees and expense_examples
- All 163 tests pass ✓

Phase 2: iXBRL Parsing Engine [COMPLETE]
- parse_contexts() extracts CIK, series_id, class_id from xbrli:context elements
- convert_numeric_value() handles scale -2, numwordsen "None", zerodash "—", negation
- strip_html_to_text() removes HTML tags and normalizes whitespace
- extract_tag_value() extracts both numeric and text iXBRL tags
- parse_date_tag() parses dates from iXBRL tags
- All 44 prospectus tests pass ✓

Phase 3: Database Upsert and CIK Processing [COMPLETE]
- _process_cik_prospectus() fetches most recent 485BPOS, parses iXBRL, extracts data
- Fee data upserted to FeeExpense with ON CONFLICT UPDATE
- Shareholder fees upserted to ShareholderFee
- Expense examples upserted to ExpenseExample
- ETF.objective_text, strategy_text, filing_url updated
- Unmatched class_ids skipped with debug log
- Missing RR tags handled with warning log
- All tests pass ✓

Phase 4: CLI Command and Entry Point [COMPLETE]
- parse_prospectus(cik, limit, clear_cache) iterates CIKs from ETF table
- CLI command `etf-pipeline prospectus` accepts --cik, --limit, --keep-cache
- Logging configured at INFO level
- edgartools cache cleared after processing (unless --keep-cache)
- All 163 tests pass ✓

Status: ALL PHASES COMPLETE ✓
Tests: 163/163 passing
