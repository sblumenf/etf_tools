{
  "feature": "ncsr-parser",
  "slug": "ncsr-parser",
  "created": "2026-02-13",
  "revised": "2026-02-13",
  "status": "approved",
  "spec_file": "docs/specs/ncsr-parser.md",
  "progress_file": "docs/specs/ncsr-parser-progress.txt",
  "phases": [
    {
      "id": 1,
      "name": "NPORT consistency fix",
      "description": "Add ciks parameter to parse_nport()",
      "verification": "python -m pytest tests/test_nport.py -v",
      "stories": ["US-1"],
      "status": "complete"
    },
    {
      "id": 2,
      "name": "Add class_id to ETF table",
      "description": "Add class_id column to ETF model, discover.py, load_etfs.py, SCHEMA.md",
      "verification": "python -m pytest tests/ -v",
      "stories": ["US-2"]
    },
    {
      "id": 3,
      "name": "Core N-CSR parser",
      "description": "Create ncsr.py using filing.xbrl().facts.to_dataframe(), ClassAxis dimension parsing, period mapping, upsert",
      "verification": "python -m pytest tests/test_ncsr.py -v",
      "stories": ["US-3"]
    },
    {
      "id": 4,
      "name": "Benchmark extraction",
      "description": "Add BroadBasedIndexAxis parsing for benchmark names and returns",
      "verification": "python -m pytest tests/test_ncsr.py -v",
      "stories": ["US-4"]
    },
    {
      "id": 5,
      "name": "CLI integration",
      "description": "Wire parse_ncsr() into cli.py ncsr command replacing stub",
      "verification": "python -m pytest tests/ -v",
      "stories": ["US-5"]
    }
  ],
  "decisions": {
    "data_source": "filing.xbrl().facts.to_dataframe() on individual N-CSR filings (NOT Company Facts API)",
    "scope": "Core metrics (returns, expense, turnover) + benchmarks. Distribution fields out of scope.",
    "history_depth": "Latest N-CSR filing only per CIK",
    "etf_mapping": "ClassAxis dimension -> class_id -> ETF.class_id lookup (1:1 with ticker)",
    "benchmark_names": "Raw XBRL member names stored as-is",
    "period_mapping": "Year-difference with +/- 30 day tolerance on period_start/period_end",
    "unmatched_classes": "Warn and skip",
    "interface_consistency": "All parsers use (cik, ciks, limit, clear_cache) signature",
    "test_fixtures": "Saved fixture data in tests/fixtures/"
  }
}
